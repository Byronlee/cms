/!breadcrumbs
div#content-header
  div#breadcrumb
    a.tip-bottom title="回到首页" href= admin_root_path
      i.icon-home
      | 首页
    a.tip-bottom title="回到信息流管理页面" href= admin_info_flows_path
      i.icon-star
      | 信息流管理
    a.current href="#"
      | 编辑信息流
  <h1>编辑信息流</h1>
/!End-breadcrumbs

div.container-fluid
  = bootstrap_flash
  div.widget-box
    div clas="widget-content" style="padding:20px;"
      select id="custom-multiselect-headers" multiple="multiple"
        - @columns.each do |column|
          - if column.in_info_flow?
            option value="#{column.id}" selected="selected"  ="#{column.name}"
          - else
            option value="#{column.id}"  ="#{column.name}"
      div.actions style="margin-top:20px;"
      button#multiselect-refresh class="btn btn-success" 重置
      button#multiselect-submit class="btn btn-primary" style="margin-left:20px;" 保存修改

javascript:
  $(document).ready(function(){
    $('#custom-multiselect-headers').multiSelect({
      keepOrder: true,
      selectableHeader: "<input type='text' class='search-input search-input-header' autocomplete='off' placeholder='type \"keywords\"'>",
      selectionHeader: "<input type='text' class='search-input search-input-header' autocomplete='off' placeholder='type \"keywords\"'>",
      afterInit: function(ms){
        var that = this,
            $selectableSearch = that.$selectableUl.prev(),
            $selectionSearch = that.$selectionUl.prev(),
            selectableSearchString = '#'+that.$container.attr('id')+' .ms-elem-selectable:not(.ms-selected)',
            selectionSearchString = '#'+that.$container.attr('id')+' .ms-elem-selection.ms-selected';

        that.qs1 = $selectableSearch.quicksearch(selectableSearchString)
        .on('keydown', function(e){
          if (e.which === 40){
            that.$selectableUl.focus();
            return false;
          }
        });

        that.qs2 = $selectionSearch.quicksearch(selectionSearchString)
        .on('keydown', function(e){
          if (e.which == 40){
            that.$selectionUl.focus();
            return false;
          }
        });
      },
      afterSelect: function(){
        this.qs1.cache();
        this.qs2.cache();
        check_submit_status();
      },
      afterDeselect: function(){
        this.qs1.cache();
        this.qs2.cache();
        check_submit_status();
      }
    });

    $('#multiselect-refresh').on('click', function(){
      location.reload();
    });

     $('#multiselect-submit').on('click', function(){
       ids = $('#custom-multiselect-headers').val();
       $.ajax({
         "url": "/admin/info_flows",
         "data": {'column_ids':ids},
         "dataType": "json",
         "type": "POST",
         "success": function () {
           window.location = '/admin/info_flows/';
         }
      });
    });

    heck_submit_status();
  });

  function check_submit_status(){
    if($('#custom-multiselect-headers').val() == null)
      $("#multiselect-submit").attr("disabled", true);
    else
      $("#multiselect-submit").attr("disabled", false);
  }
